/* In this case study, I was prompted to study video game sales between 1977 and 2022 and answered the following questions.

We have two different tables called game_details and ratings */


/* 1) What was the 15 best-selling video games? 

I chose all the details for the top 15 best-selling games */


SELECT *
    FROM game_details 
    ORDER BY total_shipped DESC
    LIMIT 15;
    
    
 /*  2) How many games in our database have missing values?
 
I joined game_details and ratings tables, then selected the count of the number games where both rating_critic and rating_user are null */

SELECT COUNT(g.game_name)
FROM game_details AS g
LEFT JOIN ratings AS r  
ON g.game_name = r.game_name
WHERE rating_critic IS NULL AND rating_user IS NULL;

 /*  3) What is the top 5 highest average rating_critic?
 
 I selected the published year and average critic rating for every year and rounded. Then, I joined both of our tables, grouped them by the published year
 and order it by the average criting rating. */


SELECT g.year, ROUND(AVG(r.rating_critic),2) AS avg_rating_critic
FROM game_details AS g
INNER JOIN ratings AS r
ON g.game_name = r.game_name
GROUP BY g.year
ORDER BY avg_rating_critic DESC
LIMIT 5;


/*  4) What was critics five favorite years considering each year must have more than four games released

 This time I have added the count of the games which are published in each year and also made sure that each year had more than four games */


SELECT g.year_published, COUNT(g.game_name) AS count_game, ROUND(AVG(r.critic_score),2) AS avg_critic_score
FROM game_sales g
INNER JOIN reviews r
ON g.game_name = r.game_name
GROUP BY g.year_published
HAVING COUNT(g.game_name) > 4
ORDER BY avg_critic_score DESC
LIMIT 5;


/*  5) What are the years that were dropped off in previous list due to not having more than four games?

I have created two new tables; First one is the five_best_critics which constitues of our question three answer, while
five_best_critics_more_than_four_games is the table generated by our answer in question four */

SELECT year_published, avg_rating_critic
FROM five_best_critics
EXCEPT
SELECT year_published, avg_rating_critic
FROM five_best_critics_more_than_four_games
ORDER BY avg_rating_critic DESC;

